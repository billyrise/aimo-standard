{% extends "base.html" %}

{# AIMO Standard - SEO and version-specific meta tags in HTML head #}
{% block extrahead %}
{{ super() }}
{# noindex for dev (preview) version - unreleased content should not be indexed #}
{# This is set by deploy-dev.yml via MIKE_DOCS_VERSION environment variable #}
{% if config.extra.is_dev_deploy %}
<meta name="robots" content="noindex, nofollow">
{% endif %}

{# --- hreflang tags for multilingual SEO --- #}
{% if page and page.canonical_url %}
{# Extract path from canonical URL #}
{% set current_path = page.canonical_url | replace(config.site_url, '') %}
{% if current_path.startswith('ja/') %}
{# JA page: EN alternate is without /ja/, JA is current #}
{% set en_path = current_path[3:] %}
<link rel="alternate" hreflang="en" href="{{ config.site_url }}{{ en_path }}">
<link rel="alternate" hreflang="ja" href="{{ page.canonical_url }}">
{% else %}
{# EN page: JA alternate has /ja/ prefix #}
<link rel="alternate" hreflang="en" href="{{ page.canonical_url }}">
<link rel="alternate" hreflang="ja" href="{{ config.site_url }}ja/{{ current_path }}">
{% endif %}
<link rel="alternate" hreflang="x-default" href="{{ config.site_url }}{{ current_path if not current_path.startswith('ja/') else current_path[3:] }}">
{% endif %}

{# --- Open Graph meta tags for social sharing --- #}
{% set og_title = page.meta.title | default(page.title) | default(config.site_name) if page else config.site_name %}
{% set og_description = page.meta.description | default(config.site_description) if page else config.site_description %}
{% set og_url = page.canonical_url | default(config.site_url) if page else config.site_url %}
{% set og_image = config.site_url ~ "assets/images/og-image.png" %}
{% set og_locale = "ja_JP" if (page and page.canonical_url and "ja/" in page.canonical_url) else "en_US" %}

<meta property="og:type" content="website">
<meta property="og:site_name" content="{{ config.site_name }}">
<meta property="og:title" content="{{ og_title }}">
<meta property="og:description" content="{{ og_description }}">
<meta property="og:url" content="{{ og_url }}">
<meta property="og:image" content="{{ og_image }}">
<meta property="og:locale" content="{{ og_locale }}">
{% if og_locale == "ja_JP" %}
<meta property="og:locale:alternate" content="en_US">
{% else %}
<meta property="og:locale:alternate" content="ja_JP">
{% endif %}

{# --- Twitter Card meta tags --- #}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ og_title }}">
<meta name="twitter:description" content="{{ og_description }}">
<meta name="twitter:image" content="{{ og_image }}">

{# --- Additional SEO meta tags --- #}
{% if page and page.meta.description %}
<meta name="description" content="{{ page.meta.description }}">
{% elif config.site_description %}
<meta name="description" content="{{ config.site_description }}">
{% endif %}
<meta name="author" content="AIMO Standard Contributors">
<meta name="keywords" content="AI governance, AI audit, agentic AI, shadow AI, taxonomy, compliance, ISO 42001, NIST AI RMF, EU AI Act, evidence management">

{# --- Structured Data (JSON-LD) --- #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "{{ config.site_name }}",
  "url": "{{ config.site_url }}",
  "description": "{{ config.site_description }}",
  "inLanguage": ["en", "ja"],
  "publisher": {
    "@type": "Organization",
    "name": "AIMO Standard Contributors",
    "url": "{{ config.site_url }}"
  },
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{{ config.site_url }}?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
{% if page %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "headline": "{{ og_title }}",
  "description": "{{ og_description }}",
  "url": "{{ og_url }}",
  "inLanguage": "{{ 'ja' if (page.canonical_url and 'ja/' in page.canonical_url) else 'en' }}",
  "isPartOf": {
    "@type": "WebSite",
    "name": "{{ config.site_name }}",
    "url": "{{ config.site_url }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "AIMO Standard Contributors",
    "url": "{{ config.site_url }}"
  },
  "about": {
    "@type": "Thing",
    "name": "AI Governance",
    "description": "Standards and frameworks for AI system governance and audit"
  },
  "keywords": "AI governance, AI audit, agentic AI, shadow AI, taxonomy, compliance"
}
</script>
{% endif %}

{# --- BreadcrumbList structured data --- #}
{% if page and page.url %}
{% set breadcrumb_parts = page.url.strip('/').split('/') %}
{% if breadcrumb_parts | length > 0 and breadcrumb_parts[0] != '' %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ config.site_url }}"
    }
    {%- for i in range(breadcrumb_parts | length) -%}
    ,{
      "@type": "ListItem",
      "position": {{ i + 2 }},
      "name": "{{ breadcrumb_parts[i] | replace('-', ' ') | title }}",
      "item": "{{ config.site_url }}{{ breadcrumb_parts[:i+1] | join('/') }}/"
    }
    {%- endfor %}
  ]
}
</script>
{% endif %}
{% endif %}
{% endblock %}
