{% extends "base.html" %}

{# AIMO Standard - SEO and version-specific meta tags in HTML head #}
{% block extrahead %}
{{ super() }}
{# noindex + canonical to release for dev (preview) - do not cite /dev/ in audits #}
{% if config.extra.is_dev_deploy %}
<meta name="robots" content="noindex, nofollow">
{% if page and page.canonical_url and '/dev/' in page.canonical_url %}
<link rel="canonical" href="{{ page.canonical_url | replace('/dev/', '/latest/') }}">
{% endif %}
{% endif %}

{# --- hreflang tags for multilingual SEO (all 10 languages) --- #}
{% if page and page.canonical_url %}
{# Extract path from canonical URL and derive the base path (without language prefix) #}
{% set current_path = page.canonical_url | replace(config.site_url, '') %}
{% set ns = namespace(base_path=current_path) %}
{% set lang_prefixes = ['ja/', 'es/', 'fr/', 'de/', 'pt/', 'it/', 'zh/', 'zh-TW/', 'ko/'] %}
{% for prefix in lang_prefixes %}
{% if current_path.startswith(prefix) %}{% set ns.base_path = current_path[prefix | length:] %}{% endif %}
{% endfor %}
<link rel="alternate" hreflang="en"       href="{{ config.site_url }}{{ ns.base_path }}">
<link rel="alternate" hreflang="ja"       href="{{ config.site_url }}ja/{{ ns.base_path }}">
<link rel="alternate" hreflang="es"       href="{{ config.site_url }}es/{{ ns.base_path }}">
<link rel="alternate" hreflang="fr"       href="{{ config.site_url }}fr/{{ ns.base_path }}">
<link rel="alternate" hreflang="de"       href="{{ config.site_url }}de/{{ ns.base_path }}">
<link rel="alternate" hreflang="pt"       href="{{ config.site_url }}pt/{{ ns.base_path }}">
<link rel="alternate" hreflang="it"       href="{{ config.site_url }}it/{{ ns.base_path }}">
<link rel="alternate" hreflang="zh-Hans"  href="{{ config.site_url }}zh/{{ ns.base_path }}">
<link rel="alternate" hreflang="zh-Hant"  href="{{ config.site_url }}zh-TW/{{ ns.base_path }}">
<link rel="alternate" hreflang="ko"       href="{{ config.site_url }}ko/{{ ns.base_path }}">
<link rel="alternate" hreflang="x-default" href="{{ config.site_url }}{{ ns.base_path }}">
{% endif %}

{# --- Open Graph meta tags for social sharing (all 10 languages) --- #}
{% set og_title = page.meta.title | default(page.title) | default(config.site_name) if page else config.site_name %}
{% set og_description = page.meta.description | default(config.site_description) if page else config.site_description %}
{% set og_url = page.canonical_url | default(config.site_url) if page else config.site_url %}
{% set og_image = config.site_url ~ "assets/images/og-image.png" %}
{# Detect current locale from URL for og:locale #}
{% set og_locale = "en_US" %}
{% if page and page.canonical_url %}
{% if "/ja/" in page.canonical_url %}{% set og_locale = "ja_JP" %}
{% elif "/es/" in page.canonical_url %}{% set og_locale = "es_ES" %}
{% elif "/fr/" in page.canonical_url %}{% set og_locale = "fr_FR" %}
{% elif "/de/" in page.canonical_url %}{% set og_locale = "de_DE" %}
{% elif "/pt/" in page.canonical_url %}{% set og_locale = "pt_BR" %}
{% elif "/it/" in page.canonical_url %}{% set og_locale = "it_IT" %}
{% elif "/zh-TW/" in page.canonical_url %}{% set og_locale = "zh_TW" %}
{% elif "/zh/" in page.canonical_url %}{% set og_locale = "zh_CN" %}
{% elif "/ko/" in page.canonical_url %}{% set og_locale = "ko_KR" %}
{% endif %}
{% endif %}

<meta property="og:type" content="website">
<meta property="og:site_name" content="{{ config.site_name }}">
<meta property="og:title" content="{{ og_title }}">
<meta property="og:description" content="{{ og_description }}">
<meta property="og:url" content="{{ og_url }}">
<meta property="og:image" content="{{ og_image }}">
<meta property="og:locale" content="{{ og_locale }}">
{% set all_og_locales = ["en_US", "ja_JP", "es_ES", "fr_FR", "de_DE", "pt_BR", "it_IT", "zh_CN", "zh_TW", "ko_KR"] %}
{% for alt_locale in all_og_locales %}{% if alt_locale != og_locale %}
<meta property="og:locale:alternate" content="{{ alt_locale }}">
{% endif %}{% endfor %}

{# --- Twitter Card meta tags --- #}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ og_title }}">
<meta name="twitter:description" content="{{ og_description }}">
<meta name="twitter:image" content="{{ og_image }}">

{# --- Additional SEO meta tags --- #}
{% if page and page.meta.description %}
<meta name="description" content="{{ page.meta.description }}">
{% elif config.site_description %}
<meta name="description" content="{{ config.site_description }}">
{% endif %}
<meta name="author" content="AIMO Standard Contributors">
<meta name="keywords" content="AI governance, AI audit, agentic AI, shadow AI, taxonomy, compliance, ISO 42001, NIST AI RMF, EU AI Act, evidence management">

{# --- Structured Data (JSON-LD) --- #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "{{ config.site_name }}",
  "url": "{{ config.site_url }}",
  "description": "{{ config.site_description }}",
  "inLanguage": ["en", "ja", "es", "fr", "de", "pt", "it", "zh", "zh-TW", "ko"],
  "publisher": {
    "@type": "Organization",
    "name": "AIMO Standard Contributors",
    "url": "{{ config.site_url }}"
  },
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{{ config.site_url }}?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
{% if page %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "headline": "{{ og_title }}",
  "description": "{{ og_description }}",
  "url": "{{ og_url }}",
  "inLanguage": "{{ 'ja' if '/ja/' in page.canonical_url else 'es' if '/es/' in page.canonical_url else 'fr' if '/fr/' in page.canonical_url else 'de' if '/de/' in page.canonical_url else 'pt' if '/pt/' in page.canonical_url else 'it' if '/it/' in page.canonical_url else 'zh-TW' if '/zh-TW/' in page.canonical_url else 'zh' if '/zh/' in page.canonical_url else 'ko' if '/ko/' in page.canonical_url else 'en' }}",
  "isPartOf": {
    "@type": "WebSite",
    "name": "{{ config.site_name }}",
    "url": "{{ config.site_url }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "AIMO Standard Contributors",
    "url": "{{ config.site_url }}"
  },
  "about": {
    "@type": "Thing",
    "name": "AI Governance",
    "description": "Standards and frameworks for AI system governance and audit"
  },
  "keywords": "AI governance, AI audit, agentic AI, shadow AI, taxonomy, compliance"
}
</script>
{% endif %}

{# --- BreadcrumbList structured data --- #}
{% if page and page.url %}
{% set breadcrumb_parts = page.url.strip('/').split('/') %}
{% if breadcrumb_parts | length > 0 and breadcrumb_parts[0] != '' %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ config.site_url }}"
    }
    {%- for i in range(breadcrumb_parts | length) -%}
    ,{
      "@type": "ListItem",
      "position": {{ i + 2 }},
      "name": "{{ breadcrumb_parts[i] | replace('-', ' ') | title }}",
      "item": "{{ config.site_url }}{{ breadcrumb_parts[:i+1] | join('/') }}/"
    }
    {%- endfor %}
  ]
}
</script>
{% endif %}
{% endif %}
{% endblock %}

{# Development preview banner: visible on every /dev/ page to prevent audit miscitation #}
{% block content %}
{% if config.extra.is_dev_deploy %}
<div class="md-dev-preview-banner" style="background:#c00;color:#fff;padding:10px 16px;text-align:center;font-weight:bold;font-size:0.95rem;">
  Development Preview — Not for audit citation. Use <a href="{{ config.site_url }}latest/" style="color:#fff;text-decoration:underline;">/latest/</a> or a versioned URL (e.g. /0.0.3/). <a href="{{ config.site_url }}latest/governance/cite/" style="color:#fff;text-decoration:underline;">How to cite</a> · <a href="{{ config.site_url }}latest/releases/" style="color:#fff;text-decoration:underline;">Releases</a>
</div>
{% endif %}
{% set _root = config.extra.site_root | d(config.site_url, true) %}
{% if _root %}
<nav class="md-version-bar" style="background:var(--md-default-fg-color--lightest, #eee);color:var(--md-default-fg-color--light);padding:6px 1rem;font-size:0.8rem;text-align:right;" aria-label="Version">
  <a href="{{ _root }}latest/">Latest</a> | <a href="{{ _root }}dev/">Dev</a> | <a href="{{ _root }}latest/standard/versions/">Versions</a>
</nav>
{% endif %}
{{ super() }}
{% endblock %}
